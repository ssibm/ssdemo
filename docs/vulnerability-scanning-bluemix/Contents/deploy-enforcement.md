<img width="71" alt="image" src="https://media.github.ibm.com/user/20538/files/099741b0-6f73-11e8-9396-35e9e2697962"> <img width="35" alt="image" src="https://media.github.ibm.com/user/20538/files/879806f0-6f71-11e8-9d14-59cc8d78bc41">

# Configure & Deploy Enforcement Deployment

----

## Overview

Image containers can be verified for security issues before they are deployed into a cluster in IBM® Cloud Kubernetes Service. The verification is handeled by policy or policies that are in place in the enviroment. The images can be controlled from where they are deployed, and the policies on them can ensure that they are also coming from a trusted source and meet security compliance. For example, if a particular pod does not meet a specific security policy that is in place, then the cluster will not be modified and the pod will be prevented from being deployed.    

"_IBM Container Image Security Enforcement gets the information about image content trust and vulnerabilities from IBM® Cloud Container Registry. You can choose whether to block or allow images from other registries in your policies, but you cannot use vulnerability or trust enforcement for these images_".

## Discoveries

Figure 1 below is a sample policy, Default cluster-wide policy, that can be implemented in a cluster enviroment. The focus on this particular policy are the components *trust* and *va*: 

```
policy:
        trust:
          enabled: true
        va:
          enabled: true
```
In summary, these two specifications in this policy determine whether an image meet the security requirememts inside the specific cluster. The **trust:** section looks for a trusted, signed image where the key is pulled from a trusted server. The **va:** section determines if the image has passed or failed a security scan performed by the Vulnerability Advisor. When both **trust:** and **va:** are set to **true** it indicates that they are both active or as listed in the policy **enabled**. When either one of these settings are set to **false** it means that the policy will bypass that particular component and the image will pass regardless of any existing security issue it may have.

In figures 2 - 4 there are live demonstration screenshots that display the results of a pod deployment affected by these policy settings discussed thus far.

There are other policies similar to the **Default Cluster-Wide policy**, for example: **Default kube-system policy**, **Default ibm-system policy**, and others that are deployed by default in a cluster. A custom policy can be created to meet the needs of a specific cluster environment and are further explained with more details here: [Enforcing container image security (beta)](https://console.bluemix.net/docs/services/Registry/registry_security_enforce.html#security_enforce). 

#### Figure 1 - Default Cluster-Wide policy
<img width="757" alt="image" src="https://media.github.ibm.com/user/20538/files/8a0bdd06-70a4-11e8-962b-8dbcce90f840">

---
#### Figure 2 - Default Cluster-Wide policy set to TRUE in an environment
<img width="674" alt="image" src="https://media.github.ibm.com/user/20538/files/78ce4cc4-70bb-11e8-970a-035a51f0125f">

#### Figure 3 - Deploying a pod using nginx failed due to policy settings listed in figure 2
<img width="1260" alt="image" src="https://media.github.ibm.com/user/20538/files/ed55f9c0-70bb-11e8-9d2b-db54b473c1b7">

#### Figure 4 - Deploying a pod using nginx is successful since policy settings change to FALSE
<img width="711" alt="image" src="https://media.github.ibm.com/user/20538/files/5e226364-70bc-11e8-8f03-752d9ea113d4">
